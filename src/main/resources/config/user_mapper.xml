<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xentn.shpee.mapper.UserMapper">
    <cache/>
    <select id="selectByUsername" resultType="com.xentn.shpee.bean.user.TUser">
        SELECT USER_ID,USERNAME,PASSWORD,EMAIL,USER_GROUP,ENABLED,ACCOUNT_NON_EXPIRED,CREDENTIALS_NON_EXPIRED,ACCOUNT_NON_LOCKED
        FROM T_SHPEE_USER
        WHERE USERNAME=#{username}
    </select>
    <select id="selectByEmail" resultType="com.xentn.shpee.bean.user.TUser">
        SELECT USER_ID,USERNAME,PASSWORD,EMAIL,USER_GROUP,ENABLED,ACCOUNT_NON_EXPIRED,CREDENTIALS_NON_EXPIRED,ACCOUNT_NON_LOCKED
        FROM T_SHPEE_USER
        WHERE EAMIL=#{email}
    </select>
    <insert id="insert" parameterType="com.xentn.shpee.bean.user.TUser">
        INSERT INTO T_SHPEE_USER(USER_ID,USERNAME,PASSWORD,EMAIL,USER_GROUP)
        VALUES(#{userId},#{username},#{password},#{email},#{group})
    </insert>
    <update id="update" parameterType="com.xentn.shpee.bean.user.TUser">
        UPDATE T_SHPEE_USER
        SET
        <if test="username!=null">
            USERNAME    = #{username}
        </if>
        <if test="password!=null">
            PASSWORD    = #{password}
        </if>
        <if test="email!=null">
            EMAIL    = #{email}
        </if>
        <if test="enabled!=null">
            ENABLED    = #{enabled}
        </if>
        <if test="accountNonExpired!=null">
            ACCOUNT_NON_EXPIRED    = #{accountNonExpired}
        </if>
        <if test="credentialsNonExpired!=null">
            CREDENTIALS_NON_EXPIRED    = #{credentialsNonExpired}
        </if>
        <if test="accountNonLocked!=null">
            ACCOUNT_NON_LOCKED    = #{accountNonLocked}
        </if>
        WHERE USER_ID = #{userId}
    </update>
    <delete id="delete" parameterType="com.xentn.shpee.bean.user.TUser">
        DELETE FROM T_SHPEE_USER WHERE USER_ID = #{userId}
    </delete>

    <select id="selectUserGroup" resultType="com.xentn.shpee.bean.user.TUserGroup">
        SELECT GROUP_ID,GROUP_NAME,ENABLED
        FROM T_USER_GROUP
        WHERE GROUP_ID=#{groupId}
    </select>
    <insert id="insertG" parameterType="com.xentn.shpee.bean.user.TUserGroup">
        INSERT INTO T_USER_GROUP(GROUP_ID,GROUP_NAME)
        VALUES(#{groupId},#{groupName})
    </insert>
    <update id="updateG" parameterType="com.xentn.shpee.bean.user.TUserGroup">
        UPDATE T_USER_GROUP
        SET
        <if test="groupName!=null">
            GROUP_NAME    = #{groupName}
        </if>
        <if test="enable!=null">
            ENABLED    = #{enable}
        </if>
        WHERE GROUP_ID = #{groupId}
    </update>
    <delete id="deleteG" parameterType="com.xentn.shpee.bean.user.TUserGroup">
        DELETE FROM T_USER_GROUP WHERE GROUP_ID = #{groupId}
    </delete>

    <select id="selectRole" resultType="string">
        SELECT r.ROLE_NAME
        FROM T_GROUP_ROLE gr, T_USER_GROUP g, T_ROLE r
        WHERE g.ENABLED = TRUE AND gr.GROUP_ID = #{groupId} AND r.ENABLED = TRUE AND gr.ROLE_ID = r.ROLE_ID
    </select>

    <select id="selectR" resultType="int">
        SELECT ROLE_ID
        FROM T_ROLE
        WHERE ROLE_NAME=#{roleName}
    </select>
    <insert id="insertR">
        INSERT INTO T_ROLE(ROLE_NAME)
        VALUES(#{roleName})
    </insert>
    <update id="updateR" parameterType="com.xentn.shpee.bean.user.TRole">
        UPDATE T_ROLE
        SET
        <if test="roleName!=null">
            ROLE_NAME    = #{roleName}
        </if>
        <if test="enable!=null">
            ENABLED    = #{enable}
        </if>
        WHERE ROLE_ID = #{roleId}
    </update>
    <delete id="deleteR" parameterType="com.xentn.shpee.bean.user.TRole">
        DELETE FROM T_ROLE WHERE ROLE_ID = #{roleId}
    </delete>

    <insert id="insertGR">
        INSERT INTO T_GROUP_ROLE(GROUP_ID,ROLE_ID)
        VALUES(#{groupId},#{roleId})
    </insert>
    <delete id="deleteGR">
        DELETE FROM T_GROUP_ROLE WHERE GROUP_ID = #{groupId} AND ROLE_ID = #{roleId}
    </delete>
</mapper>